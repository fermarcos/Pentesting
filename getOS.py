#!/usr/bin/python
#Parra Arroyo Fernando Marcos
#14-03-17
#
#Este programa recibe como paramero una ip o un nombre de dominio 
#y obtiene el fingerprint de un sistema operativo con base en el TTL de un ping
#
#Ejemplo de uso:
#	python getOs.py 8.8.8.8
#	python getOS.py google.com	
#
import subprocess
import sys
import re

#Diccionario con valores de ttl y posibles sistemas operativos correspondientes
os = {}
os["32"]=["Windows 95","Windows 98"]
os["60"]=["SunOS","AIX","Irix 5.3","Irix 6x","MacOS"]
os["64"] = ["Linux Kernel 2.4/2.6", "Google Linux","FreeBSD","Solaris"]
os["128"] = ["Windows","Windows Vista","Windows 7 (Server 2008)"]
os["254"] = ["Solaris/AIX"]
os["255"] = ["Cisco IOS","OSX/iOS","OpenBSD","NetBSD"]

#verificacion de parametros
if len(sys.argv) != 2:
	sys.exit("Uso: python getOS.py [IP o dominio]")

#se hacen 3 pings para obtener el ttl
proc = subprocess.Popen(['ping', '-c', '3', sys.argv[1]],stdout=subprocess.PIPE)
stdout, stderr = proc.communicate()
#se verifica que el ping haya sido exitoso
if proc.returncode == 0:
	print "El sistema operativo de "+sys.argv[1]+" puede ser: "
	ttl = re.search(r'ttl=[0-9]{1,3}',stdout)
	parametro=ttl.group()
	ttl_value=parametro.split("=")
	print os[ttl_value[1]]
else:
	print "Error no se obtuvo respuesta de"+sys.argv[1]